#include "game.h"

const uint16_t toadImage[32][40] = {
	{ 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0x9CF3,0x39EF,0x0000,0x0000,0x0000,0x5AE7,0xFFFF,0xFFFF,0xBDF7,0x0000,0x0000,0x0000,0x0000,0xFFDD,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
	{ 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFDD,0x18E7,0x39E7,0x5AE7,0x7BEF,0x5AE7,0x59E7,0x0000,0x39E7,0x39E7,0x0000,0xFFFF,0xFFDD,0xFFDD,0x9CF3,0x0000,0x9DF7,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
	{ 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0x9CF3,0x59E7,0xBDF7,0x7BEF,0x9CF3,0xFFDD,0xBED7,0xBDF7,0x18E7,0x0000,0xBDF7,0x7BEF,0xFFDD,0xFFFF,0xFFFF,0x39E7,0x39E7,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
	{ 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0x9CF3,0x7CEF,0x39E7,0xFFDD,0xBED7,0xBED7,0xBED7,0x9CF3,0x5AEF,0x39E7,0x9CF3,0xBDF7,0x18E7,0x39E7,0x0000,0x0000,0x5AE7,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
	{ 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFDD,0x7BEF,0x38E0,0x0000,0x7BEF,0x39E7,0xFFFF,0xBED7,0xBED7,0xFFDD,0x0000,0x0000,0x0000,0x0000,0xBDF7,0x5AEF,0x39E7,0xFFFF,0x9CF3,0x39E7,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
	{ 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xBDF7,0x7BEF,0x18E7,0x0000,0x7BEF,0x7BEF,0x7BEF,0x3AE7,0xFFFF,0xBED7,0xBED7,0xFFDD,0x5AE7,0x5AE7,0x0000,0x0000,0xBED7,0x5AE7,0xFFFF,0xFFFF,0x39E7,0x5AEF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
	{ 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0x7BEF,0x0000,0x7BEF,0xBDF7,0xFFDD,0xFFFF,0x7BEF,0x18E7,0x59E7,0x9CF3,0xFFDD,0xFFDD,0xFFDD,0xFFDD,0x19E7,0x0000,0x59E7,0x7AE7,0x59E7,0x7AEF,0x5AEF,0x0000,0xFFDD,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
	{ 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0x9CF3,0x9CF3,0xFFFF,0xFFFF,0x9CF7,0x59E0,0x79E7,0x0000,0x0000,0x0000,0x39EF,0x5AE7,0x5AEF,0x0000,0x38E0,0x79E7,0x0000,0x0000,0x0000,0x0000,0x0000,0x18E7,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
	{ 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xBDF7,0x18E7,0x9CF3,0x18E7,0x79E0,0xBBE7,0x7AE7,0x38E0,0x38E0,0x38E0,0x38E0,0x79E7,0xBAE7,0x9AE7,0x59E7,0xDCE7,0xBAE7,0x9AE7,0xBAE7,0x99E7,0x39E7,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
	{ 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0x7BEF,0x7BEF,0xBDF7,0xBDF7,0xBED7,0x7BEF,0x39E7,0x79E0,0xBAE7,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x38E0,0x79E7,0x59E7,0x38E7,0x59E7,0x5AE7,0x38E7,0xBDF7,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
	{ 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFDD,0x5AE7,0x38E0,0xDEEF,0xBDF7,0xBDF7,0xBDF7,0xBDF7,0x9CF3,0x7BEF,0x58E0,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x38E0,0x39E0,0x79E7,0x59E7,0x79E7,0x79E7,0x5AE7,0x38E0,0x39E7,0xFFDD,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
	{ 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0x7BE7,0x0000,0x0000,0x59E0,0x9CE7,0xBDF7,0xBDF7,0xBDF7,0xBDF7,0xBDF7,0x7CEF,0x58E7,0x99E0,0xBAE7,0x7AE7,0x38E0,0x39E0,0x7AE7,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x38E0,0xFFDD,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
	{ 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFDD,0x5AE7,0x5AE0,0xBDE0,0x38E0,0x0000,0x0000,0x7CE0,0xBDF7,0xBDF7,0xBDF7,0xBDF7,0xBDF7,0xBDF7,0x39EF,0x38E0,0x9AE7,0x9AE0,0xBAE7,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x7AE7,0x0000,0xFFDD,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
	{ 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0x39E7,0x5AE0,0x7BE0,0x7BE0,0x7BE0,0x5AE0,0x39E0,0x39E0,0x9CE7,0x9CF3,0xBDF7,0xBDF7,0xBDF7,0xBDF7,0xBDF7,0x9DF7,0x38E0,0x99E7,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x7AE7,0x39E0,0xFFDD,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
	{ 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xBDF7,0x39E0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7CE0,0x7AE0,0x0000,0x38E0,0x7BE0,0xBDEF,0xBDF7,0xBDF7,0xBDF7,0xBDF7,0xBED7,0x9CF3,0x5AE7,0x38E7,0x79E7,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x79E0,0x7CEF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
	{ 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0x39F7,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x0000,0x0000,0x39E0,0x9CE0,0xA63D,0xBDF7,0xBDF7,0xBDF7,0xBDF7,0xBDF7,0xBDF7,0x7BEF,0x78E0,0xBAE7,0x9AE7,0x9AE7,0xBAE7,0x38E0,0x9CF7,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
	{ 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xBED7,0x39E0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x9CE0,0x38E0,0x0000,0x39E0,0x39E0,0x9CF3,0xBDF7,0xBDF7,0xBDF7,0xBED7,0x7BEF,0x0000,0x7BEF,0x39E7,0x59E0,0x5AE0,0x19E0,0x38E0,0x0000,0x9CF7,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
	{ 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFDD,0x39E7,0x7BE0,0x39E0,0x5AE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x9CE0,0x38E0,0x38E0,0x5AE7,0xBDF7,0xBDF7,0xBDF7,0x5AE7,0x38E0,0x9AE7,0x59E7,0x5AEF,0x39E7,0x5BEF,0x38E0,0xBAE7,0xBAE7,0x0000,0xBDF7,0xFFFF,0xFFFF,0xFFFF, },
	{ 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0x5AEF,0x39E0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x5AE0,0x0000,0x0000,0x7BEF,0xFFDD,0x18E7,0x59E7,0x9AE7,0x9AE7,0x79E7,0x38E0,0x0000,0x38E0,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x38E0,0x9CF3,0xFFFF,0xFFFF, },
	{ 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0x5AE7,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x38E0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x5AE0,0x0000,0x0000,0x0000,0x7AE0,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x79E7,0x0000,0x79E7,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x79E7,0x59E7,0xFFFF,0xFFFF, },
	{ 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0x39E7,0x5AE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x39E0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x9CE0,0x59E0,0x0000,0x0000,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x59E0,0x7CEF,0x58E0,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x58E0,0x7BEF,0xFFFF, },
	{ 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xBDF7,0x39E0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x5AE0,0x5AE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7AE0,0x19E0,0x38E0,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x59E0,0xBDF7,0x9CF3,0x38E0,0x79E0,0x9AE7,0x9AE7,0x79E0,0xBCEF,0xFFFF, },
	{ 0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0x5AE7,0x5AE0,0x7BE0,0x7BE0,0x7BE0,0x5AE0,0x38E0,0x7CE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x5AE0,0x5AE0,0x5AE0,0x5AE0,0x39E7,0x7BEF,0x7AE7,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x0000,0xFFFF,0xBDF7,0x59E7,0x59E0,0x58E0,0x58E0,0xBCEF,0xFFFF, },
	{ 0xFFFF,0xFFFF,0xFFFF,0x7BEF,0x5AE7,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x5AE0,0x39E0,0x5AE0,0x38E0,0x0000,0x38E0,0x0000,0x0000,0x0000,0x0000,0x0000,0x9CF3,0x7BEF,0x9CEF,0xBED7,0xFFDD,0xFFFF,0x7BE7,0x59E7,0x9AE7,0x9AE7,0x9AE7,0x38E0,0xFFFF,0xFFFF,0xFFFF,0x9DF7,0x7BEF,0x9CEF,0xBED7,0xFFFF, },
	{ 0xFFFF,0xBDF7,0x0000,0x38E0,0x7BE0,0x7BE0,0x7BE0,0x7BE0,0x5AE0,0x39E0,0x7BE0,0x7BE0,0x7CE0,0x7BE0,0x7BE7,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0x5CEF,0x59E0,0x9AE7,0x9AE7,0x38E0,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
	{ 0xFFFF,0x7AEF,0x99E7,0xBAE7,0x59E0,0x5AE0,0x7BE0,0x7BE0,0x0000,0x5AE0,0x7BE0,0x7BE0,0x7BE0,0x39E7,0xFFDD,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0x9CF3,0x5AE7,0x79E7,0x5AE7,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
	{ 0xBDF7,0x38E0,0x9AE7,0x9AE7,0x9AE7,0x79E7,0x5AE0,0x39E0,0x59E7,0x7AE7,0x59E0,0x5AE0,0x5AE0,0x9CF7,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xBDF7,0xFFDD,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
	{ 0x9CF3,0x79E7,0x9AE7,0x9AE7,0x9AE7,0xBAE7,0x59E0,0x0000,0xDBE7,0x9AE7,0x9AE7,0x7AE7,0x0000,0xFFDD,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
	{ 0xBED7,0x39E0,0x9AE7,0x9AE7,0x9AE7,0x9AE7,0x7AE7,0xA63D,0x58E0,0x9AE7,0x7AE7,0x38E0,0xBED7,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
	{ 0xFFFF,0x9CEF,0x38E0,0x9AE7,0x9AE7,0x38E0,0x9CEF,0xFFFF,0x9CF3,0x39E0,0x39E7,0x9CF3,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
	{ 0xFFFF,0xFFDD,0x7CEF,0x5AE7,0x5AE7,0x7CEF,0xFFDD,0xFFFF,0xFFFF,0xBED7,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
	{ 0xFFFF,0xFFFF,0xFFFF,0xFFDD,0xFFDD,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF, },
};


const uint16_t TubeColor[] = {
	0X02E3, 0X0303, 0X0323, 0X0343, 0X0363, 0X0BA3, 0X0BC4, 0X13E4,
	0X1424, 0X1C44, 0X2465, 0X24A5, 0X2CC5, 0X3506, 0X3526, 0X3D47,
	0X4587, 0X4DA7, 0X4DE8, 0X5608, 0X5E49, 0X6669, 0X66A9, 0X6ECA,
	0X76EA, 0X770B, 0X7F2B, 0X874B, 0X876C, 0X8F8C, 0X8FAC, 0X97CC,
};


typedef struct TubeStruct{
	_Bool IsGrounded;
	uint16_t posX;
	uint8_t Height;
} Tube;

uint8_t score = 0;

uint16_t toad_posX;
uint16_t toad_posY;
int8_t toad_SpeedY;

Tube tubes[2];


void Game_Init()
{
	__GPIOC_CLK_ENABLE();
	GPIO_InitTypeDef GPIO_InitStruct;
	GPIO_InitStruct.Pin = GPIO_PIN_5;
	GPIO_InitStruct.Mode = GPIO_MODE_INPUT;
	GPIO_InitStruct.Pull = GPIO_PULLUP;
	GPIO_InitStruct.Speed = GPIO_SPEED_FAST;

	HAL_GPIO_Init(GPIOC, &GPIO_InitStruct);

	POINT_COLOR = DARKBLUE;
	LCD_DrawLine(0, 16, 240, 16);
	POINT_COLOR = RED;
	LCD_ShowString(3, 0, 48, 16, 16, "score: ");
	

	toad_posX = DEFAULT_TOAD_POS_X;
	toad_posY = DEFAULT_TOAD_POS_Y;
	toad_SpeedY = 0;

	tubes[0].posX = 240;
	tubes[0].Height = 150;
	tubes[0].IsGrounded = 1;

	tubes[1].posX = 120;
	tubes[1].Height = 0;
	score = 0;
}


void Toad_Go(void)
{
	if (toad_posY >= 288) {
		Game_Over();
		return;
	}

	if (SCREEN_TOUCHED) {
		toad_SpeedY = -10;
	}
	else {
		toad_SpeedY += 1;
	}

	LCD_Fill(toad_posX, toad_posY, toad_posX + 40, toad_posY + 32, BACK_COLOR);
	toad_posY += toad_SpeedY;

	if (toad_posY < 17) {
		toad_posY = 17;
		toad_SpeedY = 0;
	}

	for (uint8_t i = 0; i < 32; i++)
	{
		for (uint8_t j = 0; j < 40; j++)
		{
			if (toadImage[i][j] == 0xFFFF) continue;
			LCD_Fast_DrawPoint(toad_posX + j, toad_posY + i, toadImage[i][j]);
		}
	}
	Tube_Move();
}

void Tube_Move(void)
{
	uint16_t y1, y2;

	for (uint8_t k = 0; k < 2; k++)
	{
		if (tubes[k].IsGrounded)
		{
			y1 = 320 - tubes[k].Height;
			y2 = 320;
		}
		else
		{
			y1 = 17;
			y2 = tubes[k].Height;
		}

		if ((toad_posX > tubes[k].posX && toad_posX < tubes[k].posX + TUBE_WIDTH) 
		|| (toad_posX + 40 > tubes[k].posX && toad_posX  + 40 < tubes[k].posX + TUBE_WIDTH))
		{
			if (tubes[k].IsGrounded)
			{
				if (toad_posY + 30 > y1)
				{
					Game_Over();
					return;
				}
			}
			else
			{
				if (toad_posY < y2)
				{
					Game_Over();
					return;
				}
			}
		}

		LCD_Fill(tubes[k].posX, y1, tubes[k].posX + TUBE_WIDTH, y2, BACK_COLOR);

		tubes[k].posX -= 1;

		if (tubes[k].posX < 2)
		{
			tubes[k].posX = 240;
			tubes[k].Height = 60 + toad_posY % 180;
			tubes[k].IsGrounded = (score + toad_posY) & 1;
			LCD_ShowNum(48, 0, ++score, 3, 16);

			continue;
		}
		
		for (uint8_t i = 0; i < TUBE_WIDTH; i++)
		{
			for (uint16_t j = y1; j < y2; j++)
			{
				LCD_Fast_DrawPoint(tubes[k].posX + i, j, TubeColor[i]);
			}
		}
	}
}

void Game_Over(void)
{
	LCD_Clear(BACK_COLOR);
	LCD_ShowString(64, 120, 120, 24, 24, "Game Over!");
	LCD_ShowString(64, 160, 100, 16, 16, "your score is");
	LCD_ShowNum(170, 160, score, 3, 16);

	while (!SCREEN_TOUCHED) {
		HAL_Delay(1000);
	}
	LCD_Clear(BACK_COLOR);
	Game_Init();
}


